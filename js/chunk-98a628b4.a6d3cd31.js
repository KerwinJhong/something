(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-98a628b4"],{"0750":function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("AdminNavbarTop",{attrs:{"initial-title":t.title}}),t.isLoading?s("Spinner"):[s("div",{staticClass:"row",staticStyle:{height:"100%"}},[s("div",{staticClass:"col-8 border border-dark border-right-0 border-top-0 p-0",staticStyle:{height:"calc(100vh - 100px)"}},[s("div",[s("div",{staticClass:"container row mt-2"},[s("div",{staticClass:"col-auto mr-auto px-0"},[s("button",{staticClass:"d-none"},[t._v("推薦區")]),s("button",{staticClass:"d-none"},[t._v("菜單區")])]),s("div",[s("p",{directives:[{name:"show",rawName:"v-show",value:this.userName,expression:"this.userName"}],staticClass:"d-inline-block text-capitalize mb-0 mr-2"},[t._v(t._s(this.userName))]),s("form",{staticClass:"form-inline my-2 my-lg-0 d-inline-block"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.userPhone,expression:"userPhone"}],staticClass:"form-control",staticStyle:{width:"115px"},attrs:{type:"text",placeholder:"09XXXXXXXX"},domProps:{value:t.userPhone},on:{input:function(e){e.target.composing||(t.userPhone=e.target.value)}}}),s("button",{staticClass:"btn btn-outline-success mx-2",attrs:{type:"submit",disabled:t.searchingUser||""===t.userPhone.trim()},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.searchUser(e)}}},[t._v("搜尋會員")]),s("button",{staticClass:"btn btn-outline-success",attrs:{type:"submit"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.createUser(e)}}},[t._v("快速註冊會員")])])])]),s("AdminOrderMealTable",{attrs:{"initial-categories":t.categories,"initial-dishes":t.dishes},on:{"after-add-to-order":t.afterAddToOrder}})],1)]),s("div",{staticClass:"col-4 border border-dark border-top-0 p-0",staticStyle:{height:"calc(100vh - 100px)"}},[s("AdminOrderListTable",{attrs:{"add-dishes":t.addDishes},on:{"after-delete-dish":t.afterDeleteDish,"after-submit-order":t.aftersubmitorder}})],1)])],s("div",{directives:[{name:"show",rawName:"v-show",value:t.searchResultShow,expression:"searchResultShow"}],staticClass:"searchResult"},[s("div",{staticClass:"modal-dialog modal-lg"},[s("div",{staticClass:"modal-content"},[s("div",{staticClass:"modal-header"},[s("h5",{staticClass:"modal-title",attrs:{id:"exampleModalLabel"}},[t._v("會員資料")]),s("button",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.editUserBtn(e)}}},[t._v("編輯")])]),s("div",{staticClass:"modal-body"},[s("AdminMemberForm",{attrs:{"initial-user":t.user,"initial-orders":t.orders,"initial-edit-user":t.editUser,"initial-create-member":t.createMember},on:{"after-form-edit-cancel":t.afterFormEditCancel}})],1),s("div",{directives:[{name:"show",rawName:"v-show",value:!this.editUser,expression:"!this.editUser"}],staticClass:"modal-footer"},[s("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.afterAddUser(e)}}},[t._v("加入")]),s("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.closeResult(e)}}},[t._v("關閉")])])])])]),s("AdminNavbarBottm")],2)},r=[],a=(s("4de4"),s("b0c0"),s("a9e3"),s("2909")),n=(s("96cf"),s("1da1")),o=s("a2fe"),c=s("34f8"),u=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container"},[0===t.categories.length?s("h4",{staticClass:"my-2"},[t._v("新增一些分類吧!")]):s("ul",{staticClass:"nav nav-pills my-2"},t._l(t.categories,(function(e){return s("li",{key:e.id,staticClass:"nav-item"},[s("router-link",{staticClass:"nav-link",attrs:{to:{name:"admin-order",query:{categoryId:e.id}}}},[t._v(t._s(e.name))])],1)})),0),s("div",{staticClass:"border border-dark meal overflow-auto shadow-lg rounded-lg"},[!t.dishes.length>0?s("h1",{staticClass:"box-center"},[t._v("新增一些餐點吧!")]):t._e(),s("div",{staticClass:"card-columns"},t._l(t.dishes,(function(e){return s("div",{key:e.id,staticClass:"card dish border border-dark shadow-lg",on:{click:function(s){return s.stopPropagation(),s.preventDefault(),t.addToList(e.id,e.name,e.price)}}},[s("h5",{staticClass:"dishName"},[t._v(t._s(e.name))]),s("div",{staticClass:"row"},[s("div",{staticClass:"col-auto mr-auto px-0"},[s("span",[t._v("價格："+t._s(e.price))])]),s("button",{staticClass:"btn btn-primary",on:{click:function(s){return s.stopPropagation(),s.preventDefault(),t.showInfo(e.name,e.description)}}},[t._v("說明")])])])})),0)])])},h=[],d=(s("a4d3"),s("99af"),s("4160"),s("e439"),s("dbb4"),s("b64b"),s("159b"),s("ade3")),l=s("0003");function m(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,i)}return s}function p(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?m(Object(s),!0).forEach((function(e){Object(d["a"])(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):m(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}var f={name:"AdminOrderMealTable",props:{initialCategories:{type:Array},initialDishes:{type:Array}},data:function(){return{userPhone:"",userName:"",dishId:0,isProcessing:!1,categories:this.initialCategories,dishes:this.initialDishes}},methods:{searchUser:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){var e,s,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,this.processing=!0,t.next=4,l["a"].user.get({phone:this.userPhone});case 4:if(e=t.sent,s=e.data,i=e.statusText,"OK"===i){t.next=8;break}throw new Error(i);case 8:void 0===s.name?this.$swal({toast:!0,position:"top",showConfirmButton:!1,timer:3e3,icon:"warning",title:"未找到會員",text:""}):(this.$emit("after-add-user",{name:s.phone}),this.userName=s.name,this.isProcessing=!1),t.next=15;break;case 11:t.prev=11,t.t0=t["catch"](0),this.isProcessing=!1,console.log("error",t.t0);case 15:case"end":return t.stop()}}),t,this,[[0,11]])})));function e(){return t.apply(this,arguments)}return e}(),addToList:function(t,e,s){var i=this;this.$swal.fire({title:"<h1>請選擇數量</h1>",icon:"info",input:"number",html:"",showCloseButton:!0,showCancelButton:!0,focusConfirm:!1,confirmButtonText:'<i class="fa fa-thumbs-up"></i> 確認',cancelButtonText:'<i class="fa fa-thumbs-down"></i> 返回'}).then((function(r){+r.value>0?(i.$emit("after-add-to-order",{id:t,name:e,price:s,quantity:+r.value}),i.$swal({toast:!0,position:"top",showConfirmButton:!1,timer:3e3,icon:"success",title:"成功新增餐點",text:""})):i.$swal({toast:!0,position:"top",showConfirmButton:!1,timer:3e3,icon:"warning",title:"未新增餐點",text:""})}))},showInfo:function(t,e){this.$swal({title:t,text:e})}},created:function(){},watch:{initialDishes:function(t){this.dishes=[],this.dishes=[].concat(Object(a["a"])(this.dishes),Object(a["a"])(t))},initialCategories:function(t){this.categories={},this.categories=p({},this.categories,{},t)}}},b=f,v=(s("df93"),s("2877")),g=Object(v["a"])(b,u,h,!1,null,"4e5558b9",null),w=g.exports,y=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container"},[s("div",{staticClass:"row my-2"},[s("h5",{staticClass:"col-auto mr-auto px-0"},[t._v("總數："+t._s(this.addDishes.quantity)+"件")]),s("h5",[t._v("清單")])]),s("div",{staticClass:"border border-dark list rounded-lg"},t._l(this.addDishes.list,(function(e){return s("div",{key:e.id,staticClass:"dish border border-dark rounded-lg"},[s("h5",{staticClass:"mb-1"},[t._v(t._s(e.name))]),s("div",{staticClass:"row"},[s("div",{staticClass:"col-auto mr-auto px-0"},[s("span",[t._v("數量："+t._s(e.quantity))])]),s("button",{staticClass:"btn btn-primary",on:{click:function(s){return s.stopPropagation(),s.preventDefault(),t.handleDeleteButtonClick(e.PK,e.quantity,e.price)}}},[t._v("刪除")])])])})),0),s("h5",{staticClass:"my-2"},[t._v("備註")]),s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.memo,expression:"memo"}],staticClass:"w-100",attrs:{name:"memo",id:"",rows:"3"},domProps:{value:t.memo},on:{input:function(e){e.target.composing||(t.memo=e.target.value)}}}),s("div",{staticClass:"row my-2"},[s("button",{staticClass:"btn btn-primary col py-2",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.tableNumber(e)}}},[t._v("內用")]),s("button",{staticClass:"btn btn-primary col py-2",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.takingAway(e)}}},[t._v("外帶")]),s("button",{directives:[{name:"show",rawName:"v-show",value:this.tableNum>0||this.isTakingAway>0,expression:"this.tableNum>0 || this.isTakingAway>0"}],staticClass:"btn btn-primary col py-2",attrs:{disabled:t.isProcessing},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.submitOrder(e)}}},[t._v(t._s(t.isProcessing?"處理中...":"結帳"))])]),s("div",{staticClass:"d-flex justify-content-between text-right"},[s("h5",{directives:[{name:"show",rawName:"v-show",value:this.tableNum,expression:"this.tableNum"}]},[t._v("桌號："+t._s(this.tableNum))]),s("h5",{directives:[{name:"show",rawName:"v-show",value:this.isTakingAway,expression:"this.isTakingAway"}]},[t._v("外帶")]),s("h5",{directives:[{name:"show",rawName:"v-show",value:!this.tableNum&&!this.isTakingAway,expression:"!this.tableNum && !this.isTakingAway"}]}),s("h5",[t._v("金額："+t._s(this.addDishes.amount)+"元")])])])},C=[],x=s("60c1");function k(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,i)}return s}function O(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?k(Object(s),!0).forEach((function(e){Object(d["a"])(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):k(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}var D={name:"AdminOrderListTable",props:{addDishes:{}},data:function(){return{dishesData:this.addDishes,tableNum:0,isTakingAway:0,memo:"",quantity:0,amount:0,isProcessing:!1}},created:function(){},methods:{handleDeleteButtonClick:function(t,e,s){this.addDishes.quantity=Number(this.addDishes.quantity)-Number(e),this.addDishes.amount=this.addDishes.amount-s*e,this.$emit("after-delete-dish",t)},tableNumber:function(){var t=this;this.$swal.fire({title:"<h1>請輸入桌號</h1>",icon:"info",input:"number",html:"",showCloseButton:!0,showCancelButton:!0,focusConfirm:!1,confirmButtonText:'<i class="fa fa-thumbs-up"></i> 確認',cancelButtonText:'<i class="fa fa-thumbs-down"></i> 返回'}).then((function(e){+e.value>0?(t.isTakingAway=0,t.tableNum=+e.value):t.$swal({type:"warning",title:"未新增桌號"})}))},takingAway:function(){this.isTakingAway=1,this.tableNum=0},submitOrder:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){var e,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,this.isProcessing=!0,0!==this.addDishes.list.length){t.next=4;break}throw new Error(s);case 4:return t.next=6,x["a"].list.post({dishes:this.addDishes.list,UserId:this.addDishes.user,tableNum:this.tableNum,isTakingAway:this.isTakingAway,memo:this.memo,quantity:this.addDishes.quantity,amount:this.addDishes.amount});case 6:if(e=t.sent,e.data,s=e.statusText,"OK"===s){t.next=10;break}throw new Error(s);case 10:this.$emit("after-submit-order"),this.tableNum=0,this.isTakingAway=0,this.memo="",this.$swal({toast:!0,position:"top",showConfirmButton:!1,timer:3e3,icon:"success",title:"成功新增清單",text:""}),this.isProcessing=!1,t.next=23;break;case 18:t.prev=18,t.t0=t["catch"](0),this.$swal({icon:"warning",title:"未新增清單"}),console.log("error",t.t0),this.isProcessing=!1;case 23:case"end":return t.stop()}}),t,this,[[0,18]])})));function e(){return t.apply(this,arguments)}return e}()},watch:{addDishes:function(t){this.dishesData=O({},this.dishesData,{},t)}}},P=D,_=(s("6750"),Object(v["a"])(P,y,C,!1,null,"05013621",null)),N=_.exports,j=s("52eb"),T=s("5aa0"),A=s("cc48"),U=s("1fe3"),R=s("f742"),B=s("8055"),S=s.n(B),$={name:"AdminOrder",components:{AdminNavbarTop:o["a"],AdminNavbarBottm:c["a"],AdminOrderMealTable:w,AdminOrderListTable:N,AdminMemberForm:j["a"],Spinner:T["a"]},data:function(){return{title:"店內點餐",categories:[],dishes:[],addDishes:{list:[],user:"",quantity:0,amount:0},userName:"",userPhone:"",createMember:!1,user:{},orders:{},dishPK:0,searchingUser:!1,searchResultShow:!1,editUser:!1,isLoading:!0,socket:S()("https://recusplatform.herokuapp.com/")}},created:function(){this.socket.emit("init");var t=this.$route.query.categoryId,e=void 0===t?1:t;this.fetchDishes({categoryId:e}),this.fetchCategories()},beforeRouteUpdate:function(t,e,s){var i=t.query.categoryId,r=void 0===i?1:i;this.fetchDishes({categoryId:r}),s()},methods:{fetchCategories:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){var e,s,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,U["a"].categories.get();case 3:if(e=t.sent,s=e.data,i=e.statusText,"OK"===i){t.next=7;break}throw new Error(i);case 7:this.categories=s.categories,t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](0),console.log("error",t.t0);case 13:case"end":return t.stop()}}),t,this,[[0,10]])})));function e(){return t.apply(this,arguments)}return e}(),fetchDishes:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(e){var s,i,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,A["a"].dishes.get(e);case 3:if(s=t.sent,i=s.data,r=s.statusText,"OK"===r){t.next=7;break}throw new Error(r);case 7:this.dishes=Object(a["a"])(i.dishes),this.isLoading=!1,t.next=16;break;case 11:t.prev=11,t.t0=t["catch"](0),this.isLoading=!1,this.$swal({icon:"warning",title:"無法取得資料，請稍後再試"}),console.log("error",t.t0);case 16:case"end":return t.stop()}}),t,this,[[0,11]])})));function e(e){return t.apply(this,arguments)}return e}(),searchUser:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){var e,s,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,this.searchingUser=!0,t.next=4,R["a"].searchMember({phone:this.userPhone});case 4:if(e=t.sent,s=e.data,i=e.statusText,"OK"===i){t.next=8;break}throw new Error(i);case 8:"error"===s.status?(this.$swal({toast:!0,position:"top",showConfirmButton:!1,timer:3e3,icon:"warning",title:"未找到會員",text:""}),this.searchingUser=!1):(this.getMemberOrders(s.user.id),this.user=s.user,this.searchResultShow=!0,this.searchingUser=!1),t.next=15;break;case 11:t.prev=11,t.t0=t["catch"](0),this.searchingUser=!1,console.log("error",t.t0);case 15:case"end":return t.stop()}}),t,this,[[0,11]])})));function e(){return t.apply(this,arguments)}return e}(),afterDeleteDish:function(t){this.addDishes.list=this.addDishes.list.filter((function(e){return e.PK!==t}))},afterAddToOrder:function(t){var e=t.id,s=t.name,i=t.price,r=t.quantity;this.addDishes.list.unshift({PK:this.dishPK++,id:e,name:s,price:i,quantity:r}),this.addDishes.quantity=Number(this.addDishes.quantity)+Number(r),this.addDishes.amount=this.addDishes.amount+i*r},aftersubmitorder:function(){this.addDishes={list:[],user:"",quantity:0,amount:0},this.userName="",this.dishPK=0,this.socket.emit("addPending")},afterAddUser:function(){this.userName=this.user.Profile.name,this.addDishes.user=this.user.id,this.user={},this.userPhone="",this.searchResultShow=!1},closeResult:function(){this.searchResultShow=!1,this.user={Profile:{avatar:"",email:"",name:""},account:"",password:"",phone:"",role:""},this.editUser=!1},afterFormEditCancel:function(){this.createMember&&(this.searchResultShow=!1),this.createMember=!1,this.editUser=!1},editUserBtn:function(){this.editUser=!0},createUser:function(){this.user={Profile:{avatar:"",email:"",name:""},account:"",password:"",phone:"",role:""},this.createMember=!0,this.searchResultShow=!0,this.editUser=!0},getMemberOrders:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(e){var s,i,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,R["a"].getMemberOrders(e);case 3:if(s=t.sent,i=s.data,r=s.statusText,"OK"===r){t.next=7;break}throw new Error(r);case 7:"error"===i.status?this.$swal({toast:!0,position:"top",showConfirmButton:!1,timer:3e3,icon:"warning",title:i.msg}):this.orders=i.orders,t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](0),console.log("error",t.t0);case 13:case"end":return t.stop()}}),t,this,[[0,10]])})));function e(e){return t.apply(this,arguments)}return e}()}},q=$,E=(s("19cf"),Object(v["a"])(q,i,r,!1,null,"6a848ca4",null));e["default"]=E.exports},"0a75":function(t,e,s){},"19cf":function(t,e,s){"use strict";var i=s("0a75"),r=s.n(i);r.a},"1fe3":function(t,e,s){"use strict";s("b0c0");var i=s("2fa3");e["a"]={categories:{get:function(){return i["a"].get("/admin/categories")}},category:{get:function(t){return i["a"].get("/admin/categories/".concat(t))},post:function(t){return i["a"].post("/admin/categories",t)},put:function(t){var e=t.categoryId,s=t.name;return i["a"].put("/admin/categories/".concat(e),{name:s})},delete:function(t){return i["a"].delete("/admin/categories/".concat(t))}}}},6750:function(t,e,s){"use strict";var i=s("717b"),r=s.n(i);r.a},"717b":function(t,e,s){},b7e9:function(t,e,s){},cc48:function(t,e,s){"use strict";s("d3b7"),s("25f0"),s("3ca3"),s("ddb0"),s("2b3d");var i=s("2fa3");e["a"]={dishes:{get:function(t){var e=t.categoryId,s=new URLSearchParams({categoryId:e});return i["a"].get("/admin/dishes?".concat(s.toString()))}},dish:{get:function(t){return i["a"].get("/admin/dishes/".concat(t))},post:function(t){return i["a"].post("/admin/dishes",t)},put:function(t){var e=t.dishId,s=t.formData;return i["a"].put("/admin/dishes/".concat(e),s)},delete:function(t){return i["a"].delete("/admin/dishes/".concat(t))}}}},df93:function(t,e,s){"use strict";var i=s("b7e9"),r=s.n(i);r.a}}]);
//# sourceMappingURL=chunk-98a628b4.a6d3cd31.js.map