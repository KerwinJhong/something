(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-00bdcf9b"],{1155:function(t,e,a){"use strict";a("b0c0"),a("d3b7"),a("25f0"),a("3ca3"),a("ddb0"),a("2b3d");var i=a("2fa3");e["a"]={tag:{search:function(t){var e=new URLSearchParams(t);return i["a"].get("/admin/tag?".concat(e.toString()))},get:function(){return i["a"].get("/admin/tags")},post:function(t){return i["a"].post("/admin/tags",t)},put:function(t){var e=t.categoryId,a=t.name;return i["a"].put("/admin/tags/".concat(e),{name:a})},delete:function(t){return i["a"].delete("/admin/tags/".concat(t))}}}},"1fe3":function(t,e,a){"use strict";a("b0c0");var i=a("2fa3");e["a"]={categories:{get:function(){return i["a"].get("/admin/categories")}},category:{get:function(t){return i["a"].get("/admin/categories/".concat(t))},post:function(t){return i["a"].post("/admin/categories",t)},put:function(t){var e=t.categoryId,a=t.name;return i["a"].put("/admin/categories/".concat(e),{name:a})},delete:function(t){return i["a"].delete("/admin/categories/".concat(t))}}}},2957:function(t,e,a){"use strict";var i=a("3263"),s=a.n(i);s.a},3263:function(t,e,a){},bf91:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container h-100"},[a("AdminDishForm",{attrs:{"dish-title":t.title,"is-processing":t.isProcessing,"loaded-dish":t.loadedDish},on:{"after-submit":t.handleAfterSubmit}})],1)},s=[],r=(a("96cf"),a("1da1")),n=a("cbfe"),o=a("cc48"),c={name:"AdminDishNew",components:{AdminDishForm:n["a"]},data:function(){return{title:"新增菜單",isProcessing:!1,loadedDish:!1}},computed:{},created:function(){},methods:{handleAfterSubmit:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e){var a,i,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,this.isProcessing=!0,t.next=4,o["a"].dish.post(e);case 4:if(a=t.sent,i=a.data,s=a.statusText,"OK"===s&&"success"===i.status){t.next=9;break}throw new Error(s);case 9:this.$router.push({name:"admin-manage-meal",query:{categoryId:e.CategoryId}}),this.$swal({toast:!0,position:"top",showConfirmButton:!1,timer:3e3,icon:"success",title:"成功建立菜單",text:""}),t.next=18;break;case 13:t.prev=13,t.t0=t["catch"](0),this.isProcessing=!1,this.$swal({toast:!0,position:"top",showConfirmButton:!1,timer:3e3,icon:"warning",title:"建立菜單失敗，請稍後再試",text:""}),console.log("error",t.t0);case 18:case"end":return t.stop()}}),t,this,[[0,13]])})));function e(e){return t.apply(this,arguments)}return e}()}},d=c,u=a("2877"),l=Object(u["a"])(d,i,s,!1,null,null,null);e["default"]=l.exports},cbfe:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("form",{directives:[{name:"show",rawName:"v-show",value:t.loadedCategories&&t.loadedTags&&t.loadedDish,expression:"loadedCategories && loadedTags && loadedDish"}],staticClass:"row h-100"},[a("h1",{staticClass:"text-center mb-2 col-12"},[t._v(t._s(this.dishTitle))]),a("div",{staticClass:"form-group col-6"},[a("label",{attrs:{for:"name"}},[t._v("餐點名稱")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.dish.name,expression:"dish.name"}],staticClass:"form-control",attrs:{disabled:t.isProcessing,maxlength:"20",minlength:"1",id:"name",type:"text",name:"name",placeholder:"Enter name",required:"",autofocus:""},domProps:{value:t.dish.name},on:{input:[function(e){e.target.composing||t.$set(t.dish,"name",e.target.value)},t.$v.dish.name.$touch]}}),t.$v.dish.name.$error?a("small",{staticClass:"text-danger"},[t._v("長度介於 1 - 20")]):t._e()]),a("div",{staticClass:"form-group col-6"},[a("label",{attrs:{for:"categoryId"}},[t._v("類型")]),a("select",{directives:[{name:"model",rawName:"v-model",value:t.dish.CategoryId,expression:"dish.CategoryId"}],staticClass:"form-control",attrs:{disabled:t.isProcessing,id:"categoryId",name:"categoryId",required:""},on:{input:t.$v.dish.CategoryId.$touch,change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.dish,"CategoryId",e.target.multiple?a:a[0])}}},[a("option",{attrs:{value:"",selected:"",disabled:""}},[t._v("--請選擇--")]),t._l(t.categories,(function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(e.name))])}))],2),t.$v.dish.CategoryId.$error?a("small",{staticClass:"text-danger"},[t._v("請選擇餐點類別")]):t._e()]),a("div",{staticClass:"form-group col-6"},[a("label",{},[t._v("標籤")]),a("div",{staticClass:"form-inline mb-2"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.tag,expression:"tag"}],staticClass:"form-control mr-sm-2",attrs:{type:"text",name:"searchTag",disabled:t.isProcessing,placeholder:"Tag name"},domProps:{value:t.tag},on:{input:function(e){e.target.composing||(t.tag=e.target.value)}}}),a("button",{staticClass:"btn btn-primary",attrs:{type:"button",disabled:t.isProcessing},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.searchTag(e)}}},[t._v("搜尋")])]),t._l(t.tagsDisplay,(function(e){return a("button",{key:e.id,staticClass:"btn btn-primary mr-2 mt-2",attrs:{disabled:t.isProcessing},on:{click:function(a){return a.stopPropagation(),a.preventDefault(),t.addTag(e)}}},[t._v(t._s(e.name))])}))],2),a("div",{staticClass:"form-group col-6"},[a("label",{staticClass:"d-block",attrs:{for:"image"}},[t._v("相片")]),t.dish.image?a("img",{staticClass:"img-thumbnail",attrs:{src:t.dish.image,width:"200",height:"200"}}):t._e(),a("input",{staticClass:"align-bottom",attrs:{id:"image",type:"file",name:"image",accept:"image/*",disabled:t.isProcessing},on:{change:t.handleFileChange}})]),a("div",{staticClass:"form-group col-6"},[a("label",{staticClass:"mr-4",attrs:{for:"description"}},[t._v("內容")]),t._l(this.dish.tags,(function(e){return a("button",{key:e.id,staticClass:"btn btn-primary mr-2 mb-2",attrs:{disabled:t.isProcessing},on:{click:function(a){return a.stopPropagation(),a.preventDefault(),t.removeTag(e)}}},[t._v("#"+t._s(e.name))])})),a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.dish.description,expression:"dish.description"}],staticClass:"form-control",attrs:{id:"description",disabled:t.isProcessing,rows:"3",name:"description"},domProps:{value:t.dish.description},on:{input:function(e){e.target.composing||t.$set(t.dish,"description",e.target.value)}}})],2),a("div",{staticClass:"form-group col-6"},[a("label",{attrs:{for:"price"}},[t._v("價格")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.dish.price,expression:"dish.price"}],staticClass:"form-control",attrs:{id:"price",type:"number",disabled:t.isProcessing,name:"price",required:"",autofocus:""},domProps:{value:t.dish.price},on:{input:[function(e){e.target.composing||t.$set(t.dish,"price",e.target.value)},t.$v.dish.price.$touch]}}),t.$v.dish.price.$error?a("small",{staticClass:"text-danger"},[t._v("請輸入價格")]):t._e()]),a("div",{staticClass:"form-group col-12 mb-0"},[a("button",{staticClass:"btn btn-primary col-6 py-3",attrs:{disabled:t.isProcessing},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.$router.back()}}},[t._v("回上一頁")]),a("button",{staticClass:"btn btn-primary col-6 py-3",attrs:{type:"submit",disabled:t.isProcessing||t.$v.$invalid},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.handleSubmit(e)}}},[t._v(t._s(this.isProcessing?"處理中...":"送出"))])])])},s=[],r=(a("a4d3"),a("e01a"),a("99af"),a("4de4"),a("c975"),a("d81d"),a("fb6a"),a("b0c0"),a("d3b7"),a("ac1f"),a("6062"),a("3ca3"),a("841c"),a("ddb0"),a("2b3d"),a("96cf"),a("1da1")),n=a("2909"),o=a("1fe3"),c=a("cc48"),d=a("1155"),u=a("b5ae"),l={name:"AdminDishForm",props:{dishTitle:{type:String},isProcessing:{type:Boolean,default:!1}},data:function(){return{dish:{name:"",CategoryId:"",price:"",option:"",tags:[],description:"",image:"",addTags:[],removeTags:[]},originTags:[],categories:[],allTags:[],tag:"",searchResult:[],tagSelected:[],loadedCategories:!1,loadedTags:!1,loadedDish:!1}},validations:{dish:{name:{required:u["required"],minLength:Object(u["minLength"])(1),maxLength:Object(u["maxLength"])(20)},CategoryId:{required:u["required"]},price:{required:u["required"]}}},computed:{tagsDisplay:function(){var t=[].concat(Object(n["a"])(this.searchResult),Object(n["a"])(this.allTags)),e=t.filter((function(t){var e=t.id,a=t.name,i="".concat(e).concat(a);return!this.has(i)&&this.add(i)}),new Set),a=e.slice(0,6);return a}},watch:{},created:function(){if(this.fetchCategories(),this.fetchTags(),"number"===typeof this.$route.params.id){var t=this.$route.params.id;this.fetchDish(t)}else this.loadedDish=!0},methods:{fetchCategories:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var e,a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,o["a"].categories.get();case 3:if(e=t.sent,a=e.data,i=e.statusText,"OK"===i){t.next=7;break}throw new Error(i);case 7:this.categories=a.categories,this.loadedCategories=!0,t.next=15;break;case 11:t.prev=11,t.t0=t["catch"](0),this.loadedCategories=!0,console.log("error",t.t0);case 15:case"end":return t.stop()}}),t,this,[[0,11]])})));function e(){return t.apply(this,arguments)}return e}(),fetchTags:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var e,a,i,s=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,d["a"].tag.get();case 3:if(e=t.sent,a=e.data,i=e.statusText,"OK"===i){t.next=7;break}throw new Error(i);case 7:a.tags.map((function(t){s.allTags.push({id:t.id,name:t.name})})),this.loadedTags=!0,t.next=15;break;case 11:t.prev=11,t.t0=t["catch"](0),this.loadedTags=!0,console.log("error",t.t0);case 15:case"end":return t.stop()}}),t,this,[[0,11]])})));function e(){return t.apply(this,arguments)}return e}(),fetchDish:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e){var a,i,s,r=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,c["a"].dish.get(e);case 3:if(a=t.sent,i=a.data,s=a.statusText,"OK"===s){t.next=8;break}throw new Error(s);case 8:this.dish.name=i.dish.name,this.dish.CategoryId=i.dish.CategoryId,this.dish.price=i.dish.price,i.dish.hasTags.map((function(t){r.dish.tags.push({id:t.id,name:t.name}),r.originTags.push({id:t.id,name:t.name})})),this.dish.description=i.dish.description,this.dish.image=i.dish.image,this.loadedDish=!0,t.next=22;break;case 17:t.prev=17,t.t0=t["catch"](0),this.loadedDish=!0,this.$swal({toast:!0,position:"top",showConfirmButton:!1,timer:3e3,icon:"warning",title:"找不到菜單，請稍後再試",text:""}),console.log("error",t.t0);case 22:case"end":return t.stop()}}),t,this,[[0,17]])})));function e(e){return t.apply(this,arguments)}return e}(),searchTag:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var e,a,i,s=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,d["a"].tag.search({name:this.tag});case 3:if(e=t.sent,a=e.data,i=e.statusText,"OK"===i){t.next=7;break}throw new Error(i);case 7:0===a.length&&this.$swal({toast:!0,position:"top",showConfirmButton:!1,timer:3e3,icon:"warning",title:"未找到相關標籤",text:""}),this.searchResult=[],a.map((function(t){s.searchResult.push({id:t.id,name:t.name})})),t.next=15;break;case 12:t.prev=12,t.t0=t["catch"](0),console.log("error",t.t0);case 15:case"end":return t.stop()}}),t,this,[[0,12]])})));function e(){return t.apply(this,arguments)}return e}(),handleFileChange:function(t){var e=t.target.files;if(e.length){var a=window.URL.createObjectURL(e[0]);this.dish.image=a}},addTag:function(t){var e=this.dish.tags.map((function(t){return t.name})).indexOf(t.name);-1===e&&this.dish.tags.unshift(t)},removeTag:function(t){this.dish.tags=this.dish.tags.filter((function(e){return e!==t}))},handleSubmit:function(){this.dish.name?this.dish.CategoryId?this.$emit("after-submit",this.dish):this.$swal({toast:!0,position:"top",showConfirmButton:!1,timer:3e3,icon:"warning",title:"請選擇餐點類別",text:""}):this.$swal({toast:!0,position:"top",showConfirmButton:!1,timer:3e3,icon:"warning",title:"請填寫餐點名稱",text:""})}}},h=l,m=(a("2957"),a("2877")),g=Object(m["a"])(h,i,s,!1,null,"0729ddc4",null);e["a"]=g.exports},cc48:function(t,e,a){"use strict";a("d3b7"),a("25f0"),a("3ca3"),a("ddb0"),a("2b3d");var i=a("2fa3");e["a"]={dishes:{get:function(t){var e=t.categoryId,a=new URLSearchParams({categoryId:e});return i["a"].get("/admin/dishes?".concat(a.toString()))}},dish:{get:function(t){return i["a"].get("/admin/dishes/".concat(t))},post:function(t){return i["a"].post("/admin/dishes",t)},put:function(t){var e=t.dishId,a=t.formData;return i["a"].put("/admin/dishes/".concat(e),a)},delete:function(t){return i["a"].delete("/admin/dishes/".concat(t))}}}}}]);
//# sourceMappingURL=chunk-00bdcf9b.aa7a1d89.js.map