(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-21361d12"],{"20f9":function(t,e,r){},"4e82":function(t,e,r){"use strict";var s=r("23e7"),a=r("1c0b"),i=r("7b0b"),n=r("d039"),o=r("a640"),c=[],l=c.sort,u=n((function(){c.sort(void 0)})),h=n((function(){c.sort(null)})),p=o("sort"),d=u||!h||!p;s({target:"Array",proto:!0,forced:d},{sort:function(t){return void 0===t?l.call(i(this)):l.call(i(this),a(t))}})},b3c3:function(t,e,r){"use strict";var s=r("dee1"),a=r.n(s);a.a},bc10:function(t,e,r){"use strict";var s=r("20f9"),a=r.n(s);a.a},d81d:function(t,e,r){"use strict";var s=r("23e7"),a=r("b727").map,i=r("1dde"),n=r("ae40"),o=i("map"),c=n("map");s({target:"Array",proto:!0,forced:!o||!c},{map:function(t){return a(this,t,arguments.length>1?arguments[1]:void 0)}})},dee1:function(t,e,r){},f3f4:function(t,e,r){"use strict";r.r(e);var s=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("AdminNavbarTop",{attrs:{"initial-title":t.title}}),t.isLoading?r("Spinner"):[r("div",{staticClass:"row my-lg-3 my-xl-2"},[r("form",{staticClass:"form-inline my-2 my-lg-0 d-inline-block col-4",attrs:{action:"/search"}},[r("input",{directives:[{name:"model",rawName:"v-model",value:t.userPhone,expression:"userPhone"}],staticClass:"form-control mr-sm-2",attrs:{type:"text",name:"keyword",placeholder:"輸入手機電話..."},domProps:{value:t.userPhone},on:{input:function(e){e.target.composing||(t.userPhone=e.target.value)}}}),r("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.searchUser(e)}}},[t._v("搜尋")])]),r("div",{staticClass:"d-inline-block col-4 d-flex justify-content-center"},[r("nav",{attrs:{"aria-label":"Page navigation example"}},[r("ul",{staticClass:"pagination mb-0"},[r("li",{directives:[{name:"show",rawName:"v-show",value:t.prevPage,expression:"prevPage"}],staticClass:"page-item"},[r("router-link",{staticClass:"page-link",staticStyle:{"padding-top":"3px"},attrs:{"aria-label":"Previous",to:{name:"admin-manage-members",query:{page:t.prevPage}}}},[r("span",{attrs:{"aria-hidden":"true"}},[t._v("«")])])],1),t._l(t.totalPage,(function(e){return r("li",{key:e,class:["page-item",{active:t.currPage===e}]},[r("router-link",{staticClass:"page-link",attrs:{to:{name:"admin-manage-members",query:{page:e}}}},[t._v(t._s(e))])],1)})),r("li",{directives:[{name:"show",rawName:"v-show",value:t.nextPage,expression:"nextPage"}],staticClass:"page-item"},[r("router-link",{staticClass:"page-link",staticStyle:{"padding-top":"3px"},attrs:{to:{name:"admin-manage-members",query:{page:t.nextPage}},"aria-label":"Next"}},[r("span",{attrs:{"aria-hidden":"true"}},[t._v("»")])])],1)],2)])]),r("div",{staticClass:"col-4"})]),r("div",{directives:[{name:"show",rawName:"v-show",value:t.searchResultShow,expression:"searchResultShow"}],staticClass:"searchResult"},[r("div",{staticClass:"modal-dialog modal-xl",attrs:{role:"document"}},[r("div",{staticClass:"modal-content"},[r("div",{staticClass:"modal-header"},[r("h5",{staticClass:"modal-title",attrs:{id:"exampleModalLabel"}},[t._v("搜尋結果")])]),r("div",{staticClass:"modal-body"},[r("AdminMemberTable",{attrs:{"initial-users":t.searchResult},on:{"after-valid-user":t.afterValidUser,"after-toggle-is-admin":t.afterToggleIsAdmin,"after-show-profile":t.afterShowProfile}})],1),r("div",{staticClass:"modal-footer"},[r("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.closeResult(e)}}},[t._v("Close")])])])])]),r("div",{directives:[{name:"show",rawName:"v-show",value:t.showProfile,expression:"showProfile"}],staticClass:"profileForm"},[r("div",{staticClass:"modal-dialog modal-lg"},[r("div",{staticClass:"modal-content"},[r("div",{staticClass:"modal-header"},[r("h5",{staticClass:"modal-title"},[t._v("會員資料")]),r("button",{staticClass:"btn btn-danger",attrs:{type:"button",disabled:t.isProcessing},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.deleteUser(t.profile.id)}}},[t._v(t._s(this.isProcessing?"處理中...":"刪除會員"))])]),r("div",{staticClass:"modal-body"},[r("AdminMemberForm",{attrs:{"initial-user":t.profile,"initial-orders":t.orders}})],1),r("div",{staticClass:"modal-footer"},[r("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.closeProfile(e)}}},[t._v("關閉")])])])])]),r("div",{staticClass:"row"},[r("div",{staticClass:"col-6 px-1"},[r("AdminMemberTable",{attrs:{"initial-users":t.leftTableUsers},on:{"after-valid-user":t.afterValidUser,"after-toggle-is-admin":t.afterToggleIsAdmin,"after-show-profile":t.afterShowProfile}})],1),r("div",{staticClass:"col-6 px-1"},[r("AdminMemberTable",{attrs:{"initial-users":t.rightTableUsers},on:{"after-valid-user":t.afterValidUser,"after-toggle-is-admin":t.afterToggleIsAdmin,"after-show-profile":t.afterShowProfile}})],1)])],r("AdminNavbarBottm")],2)},a=[],i=(r("a4d3"),r("4de4"),r("4160"),r("d81d"),r("4e82"),r("a9e3"),r("e439"),r("dbb4"),r("b64b"),r("159b"),r("ade3")),n=r("2909"),o=(r("96cf"),r("1da1")),c=r("a2fe"),l=r("34f8"),u=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[t._m(0),r("div",{staticClass:"table-data"},[r("table",{staticClass:"table table-striped table-bordered"},[r("tbody",{staticClass:"text-center"},t._l(t.users,(function(e){return r("tr",{key:e.id},[r("th",{attrs:{width:"20%"}},[r("p",{staticClass:"text-capitalize text-primary",staticStyle:{cursor:"pointer"},on:{click:function(r){return r.stopPropagation(),r.preventDefault(),t.showProfile(e.phone)}}},[t._v(t._s(e.Profile.name))])]),r("td",{attrs:{height:"50px"}},[r("div",{staticClass:"user-name"},[t._v(t._s(e.phone))])]),r("td",{attrs:{width:"20%"}},[r("div",{staticClass:"user-name"},[t._v(t._s(e.consumeCount||0))])]),r("td",{attrs:{width:"20%"}},[e.Profile.name!==t.currentUser?r("button",{staticClass:"btn btn-warning text-capitalize",attrs:{type:"button"},on:{click:function(r){return r.stopPropagation(),r.preventDefault(),t.toggleIsAdmin(e.id)}}},[t._v(t._s(e.role))]):t._e()]),r("td",{attrs:{width:"15%"}},[e.Profile.name===t.currentUser&&e.isValid?t._e():r("button",{staticClass:"btn btn-danger",attrs:{type:"button"},on:{click:function(r){return r.stopPropagation(),r.preventDefault(),t.validCheck(e.id)}}},[t._v(t._s(e.isValid?"取消":"同意"))])])])})),0)])])])},h=[function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("table",{staticClass:"table table-striped table-bordered table-hover mb-0"},[r("thead",{staticClass:"thead-dark text-center"},[r("tr",[r("th",{attrs:{width:"20%"}},[t._v("名稱")]),r("th",[t._v("手機")]),r("th",{attrs:{width:"20%"}},[t._v("消費次數")]),r("th",{attrs:{width:"20%"}},[t._v("權限")]),r("th",{attrs:{width:"15%"}},[t._v("驗證")])])])])}];r("b0c0");function p(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,s)}return r}function d(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?p(Object(r),!0).forEach((function(e){Object(i["a"])(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var f={name:"AdminMemberTable",props:{initialUsers:{type:Array}},data:function(){return{users:this.initialUsers,currentUser:this.$store.state.currentUser.name}},methods:{validCheck:function(t){this.$emit("after-valid-user",t)},toggleIsAdmin:function(t){this.$emit("after-toggle-is-admin",t)},showProfile:function(t){this.$emit("after-show-profile",t)}},watch:{initialUsers:function(t){this.users={},this.users=d({},this.users,{},t)}}},m=f,g=(r("bc10"),r("2877")),b=Object(g["a"])(m,u,h,!1,null,"5863fed4",null),v=b.exports,w=r("52eb"),P=r("5aa0"),x=r("f742"),y=r("0003"),O=r("8055"),C=r.n(O);function k(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,s)}return r}function _(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?k(Object(r),!0).forEach((function(e){Object(i["a"])(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):k(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var j={name:"AdminManageMember",components:{AdminNavbarTop:c["a"],AdminNavbarBottm:l["a"],AdminMemberTable:v,AdminMemberForm:w["a"],Spinner:P["a"]},data:function(){return{title:"會員管理",users:[],searchResult:[],orders:[],userPhone:"",totalPage:1,currPage:1,profile:{},showProfile:!1,searchResultShow:!1,isProcessing:!1,isLoading:!0,socket:C()("https://recusplatform.herokuapp.com/")}},computed:{prevPage:function(){return 1===this.currPage?null:this.currPage-1},nextPage:function(){return this.currPage+1>this.totalPage?null:this.currPage+1},leftTableUsers:function(){for(var t=this.users.length-1,e=[],r=0;r<=t;r++)0!==r&&r%2!==0||e.push(this.users[r]);return e},rightTableUsers:function(){for(var t=this.users.length-1,e=[],r=0;r<=t;r++)r%2!==0&&e.push(this.users[r]);return e}},created:function(){this.socket.emit("init");var t=this.$route.query.page,e=void 0===t?1:t;this.fetchProfiles({page:e})},beforeRouteUpdate:function(t,e,r){var s=t.query.page,a=void 0===s?1:s;this.fetchProfiles({page:a}),r()},methods:{fetchProfiles:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(e){var r,s,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,x["a"].getMembers(e);case 3:if(r=t.sent,s=r.data,a=r.statusText,"OK"===a){t.next=8;break}throw new Error(a);case 8:this.totalPage=s.totalPage,this.currPage=s.currPage,this.users=Object(n["a"])(s.users).map((function(t){return _({},t,{consumeCount:t.orders})})).sort((function(t,e){return Number(t.id)-Number(e.id)})),this.isLoading=!1,t.next=19;break;case 14:t.prev=14,t.t0=t["catch"](0),this.isLoading=!1,this.$swal({icon:"error",title:"無法取得資料，請稍後再試"}),console.log("error",t.t0);case 19:case"end":return t.stop()}}),t,this,[[0,14]])})));function e(e){return t.apply(this,arguments)}return e}(),deleteUser:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(e){var r,s,a,i,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,this.isProcessing=!0,t.next=4,x["a"].deleteMember({userId:e});case 4:if(r=t.sent,s=r.data,a=r.statusText,"OK"===a&&"success"===s.status){t.next=10;break}throw this.$swal({icon:"error",title:s.msg}),new Error(a);case 10:this.showProfile=!1,this.searchResultShow=!1,i=this.$route.query.page,n=void 0===i?1:i,this.fetchProfiles({page:n}),this.$swal({toast:!0,position:"top",showConfirmButton:!1,timer:3e3,icon:"success",title:s.msg,text:""}),this.isProcessing=!1,t.next=22;break;case 18:t.prev=18,t.t0=t["catch"](0),this.isProcessing=!1,console.log("error",t.t0);case 22:case"end":return t.stop()}}),t,this,[[0,18]])})));function e(e){return t.apply(this,arguments)}return e}(),afterValidUser:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(e){var r,s,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,x["a"].validMember({userId:e});case 3:if(r=t.sent,s=r.data,a=r.statusText,"OK"===a&&"success"===s.status){t.next=9;break}throw this.$swal({icon:"error",title:s.msg}),new Error(a);case 9:this.users=this.users.map((function(t){return t.id!==e?t:_({},t,{isValid:!t.isValid})})),this.$swal({toast:!0,position:"top",showConfirmButton:!1,timer:3e3,icon:"success",title:s.msg,text:""}),t.next=16;break;case 13:t.prev=13,t.t0=t["catch"](0),console.log("error",t.t0);case 16:case"end":return t.stop()}}),t,this,[[0,13]])})));function e(e){return t.apply(this,arguments)}return e}(),afterToggleIsAdmin:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(e){var r,s,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,x["a"].toggleAdmin({userId:e});case 3:if(r=t.sent,s=r.data,a=r.statusText,"OK"===a&&"success"===s.status){t.next=9;break}throw this.$swal({icon:"error",title:s.msg}),new Error(a);case 9:this.users=this.users.map((function(t){return t.id!==e?t:_({},t,{role:s.user.role})})),this.searchResult=this.searchResult.map((function(t){return t.id!==e?t:_({},t,{role:s.user.role})})),this.$swal({toast:!0,position:"top",showConfirmButton:!1,timer:3e3,icon:"success",title:s.msg}),t.next=17;break;case 14:t.prev=14,t.t0=t["catch"](0),console.log("error",t.t0);case 17:case"end":return t.stop()}}),t,this,[[0,14]])})));function e(e){return t.apply(this,arguments)}return e}(),searchUser:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(){var e,r,s,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,y["a"].user.get({phone:this.userPhone});case 3:if(e=t.sent,r=e.data,s=e.statusText,"OK"===s){t.next=7;break}throw new Error(s);case 7:"error"===r.status?this.$swal({toast:!0,position:"top",showConfirmButton:!1,timer:3e3,icon:"warning",title:r.msg}):(this.userPhone="",this.searchResult=[r.user],a=this.searchResult[0].Profile,this.searchResult[0].consumeCount=a.length,this.searchResultShow=!0),t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](0),console.log("error",t.t0);case 13:case"end":return t.stop()}}),t,this,[[0,10]])})));function e(){return t.apply(this,arguments)}return e}(),getMemberOrders:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(e){var r,s,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,x["a"].getMemberOrders(e);case 3:if(r=t.sent,s=r.data,a=r.statusText,"OK"===a){t.next=7;break}throw new Error(a);case 7:"error"===s.status?this.$swal({toast:!0,position:"top",showConfirmButton:!1,timer:3e3,icon:"warning",title:s.msg}):(this.orders=s.orders,this.showProfile=!0),t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](0),console.log("error",t.t0);case 13:case"end":return t.stop()}}),t,this,[[0,10]])})));function e(e){return t.apply(this,arguments)}return e}(),closeResult:function(){this.searchResult=[],this.searchResultShow=!1},afterShowProfile:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(e){var r,s,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,x["a"].searchMember({phone:e});case 3:if(r=t.sent,s=r.data,a=r.statusText,"OK"===a){t.next=7;break}throw new Error(a);case 7:"error"===s.status?this.$swal({toast:!0,position:"top",showConfirmButton:!1,timer:3e3,icon:"warning",title:"未找到會員",text:""}):(this.profile=s.user,this.getMemberOrders(s.user.id)),t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](0),console.log("error",t.t0);case 13:case"end":return t.stop()}}),t,this,[[0,10]])})));function e(e){return t.apply(this,arguments)}return e}(),closeProfile:function(){this.profile={},this.showProfile=!1}}},R=j,A=(r("b3c3"),Object(g["a"])(R,s,a,!1,null,"6f06389d",null));e["default"]=A.exports}}]);
//# sourceMappingURL=chunk-21361d12.fed22667.js.map